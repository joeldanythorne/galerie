<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Ketarot</title>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
<main id=app>

<h1 id="titre"></h1>
<div id="galerie-wrapper"></div>
<script>

const queryString = window.location.search;
console.log(queryString);

const urlParams = new URLSearchParams(queryString);


states_dictionary2={ 
  '01': "vitrai-uvh",
  '02': "bleuet",
  '03': "bottine",
  '04': "clown",
  '05': "conspipuppet",
  '06': "crimesoda",
  '07': "ensemble",
  '08': "evildead",
  '09': "file-indienne",
  '10': "friday13",
  '11': "gaudet",
  '12': "godzilla",
  '13': "groundhog",
  '14': "guenilles",
  '15': "hugo",
  '16': "karltremblay",
  '17': "karma",
  '18': "lego",
  '19': "lotr",
  '20': "louiseville2024",
  '21': "lynda",
  '22': "mado",
  '23': "maillet",
  '24': "matrix",
  '25': "orgonite01",
  '26': "orgonite3",
  '27': "orgonite-de-nowel",
  '28': "peter",
  '29': "probtechniques",
  '30': "pti-joel",
  '31': "mitevh",
  '32': "napu",
  '33': "singerome",
  '34': "starwars",
  '35': "steve",
  '36': "taser",
  '37': "theremin",
  '38': "trump",
  '39': "trump2",
  '40': "une-fois-au-chalet",
  '41': "uvh",
  '42': "stucco",
  '43': "nightmare"
}

var viewer = urlParams.get('viewer').toLowerCase()

//let text = "<h1>Collection de " + viewer + "</h1>";
document.getElementById("titre").innerHTML = "<h1>Collection de " + viewer + "</h1>";
let text =  '<section class="galerie">';

console.log("File:: ./collectioninfo/"+ viewer +".json")

async function Fetching() {
  // Section HTML qui va contenir toutes les cartes
  let text = '<section class="galerie">';

  try {
    // Récupère le JSON du viewer (ex: ./collectioninfo/ccsuburban.json)
    const response = await fetch('./collectioninfo/' + viewer + '.json');

    if (!response.ok) {
      console.error('Erreur de chargement du JSON pour', viewer, response.status);
      text += '<p class="error">Impossible de charger la collection.</p>';
    } else {
      const jsonData = await response.json();

      console.log('Collection chargée pour le viewer :', viewer);
      console.log('Nombre de cartes définies :', Object.keys(states_dictionary2).length);

      const totalCards = Object.keys(states_dictionary2).length;

      // Boucle sur toutes les cartes définies dans states_dictionary2
      for (let i = 1; i <= totalCards; i++) {
        // "01", "02", "03", ...
        const znumber = i.toString().padStart(2, '0');

        // Nom de la carte / clé JSON (ex: "vitrai-uvh", "bleuet", etc.)
        const cardKey = states_dictionary2[znumber];

        // Valeur dans le JSON: 1 = possède, 0 ou undefined = ne possède pas
        const owned = jsonData[cardKey] === 1;

        // Wrapper 3D autour de la carte
        text += '<div class="three-d-wrapper">';

        if (owned) {
          // Carte possédée → version "normale"
          console.log('Carte possédée :', cardKey, '(c' + znumber + ')');
          text += '<div class="cadre c' + znumber + ' animated"></div>';
        } else {
          // Carte non possédée → version "dos / grisée / autre visuel"
          console.log('Carte non possédée :', cardKey, '(c' + znumber + ')');
          text += '<div class="sans-cadre c' + znumber + ' animated"></div>';
        }

        text += '</div>'; // fin .three-d-wrapper
      }
    }
  } catch (err) {
    console.error('Erreur dans Fetching() :', err);
    text += '<p class="error">Erreur interne lors du chargement des cartes.</p>';
  }

  // Fermeture de la section et injection dans la page
  text += '</section>';
  document.getElementById('galerie-wrapper').innerHTML = text;
}

// Lancer au chargement
Fetching();


</script>

<!-- <style class="hover"></style> -->


</main>

</body>
</html>
